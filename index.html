<html>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style> circle {fill: lightblue; stroke: black;} </style>
    <body onload='init()'>
        <label for="cylinders">Select number of cylinders: </label>
        <select id="cylinders" onchange="update()">
          <option value="all">All</option>
          <option value="4">4</option>
          <option value="6">6</option>
          <option value="8">8</option>
        </select>
        <svg width=300 height=300>
        </svg>
        <script>
            async function init() {
                const data = await d3.csv("https://flunky.github.io/cars2017.csv");
                update();
            }

            function update() {
                const selectedCylinders = document.getElementById("cylinders").value;

                // Set up the SVG dimensions and margins
                const margin = 50;
                const width = 300 - 2*margin;
                const height = 300 - 2*margin;

                // Create SVG element
                const svg = d3.select("svg")
                    .attr("width", width + 2*margin)
                    .attr("height", height + 2*margin)
                    .append("g")
                    .attr("transform", `translate(${margin},${margin})`);

                // Define scales and axes
                const xScale = d3.scaleLog()
                    .domain([10, 150])
                    .range([0, width]);

                const yScale = d3.scaleLog()
                    .domain([10, 150])
                    .range([height, 0]);

                const xAxis = d3.axisBottom(xScale)
                    .tickValues([10, 20, 50, 100])
                    .tickFormat(d3.format("~s"));

                const yAxis = d3.axisLeft(yScale)
                    .tickValues([10, 20, 50, 100])
                    .tickFormat(d3.format("~s"));

                // Filter data based on selected cylinders and fuel type
                    const filteredData = data.filter(d => {
                        const fuel = d['Fuel'];
                        const cylinders = d['EngineCylinders'];
                        return (fuel !== 'Electricity') && (selectedCylinders === 'all' || cylinders == selectedCylinders);
                    });

                svg.selectAll("circle")
                    .data(data)
                    .enter().append("circle")
                    .attr("cx", d => xScale(parseFloat(d['AverageCityMPG'])))
                    .attr("cy", d => yScale(parseFloat(d['AverageHighwayMPG'])))
                    .attr("r", d => 2 + parseInt(d['EngineCylinders']))
                    .style("fill", d => {
                        if (d['Fuel'] === 'Gasoline') return 'black';
                        else return 'green';
                    });

                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", `translate(0, ${height})`)
                    .call(xAxis);

                svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis);
            }

        </script>
    </body>
</html>
        